<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS API æµ‹è¯•</title>
</head>
<body>
    <h1>TTS API æµ‹è¯•</h1>
    <button onclick="testTTSAPI()">æµ‹è¯• TTS API</button>
    <div id="result"></div>

    <script>
        async function testTTSAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                console.log('ğŸ§ª å¼€å§‹æµ‹è¯•TTS API...');
                
                const apiUrl = 'https://xbpethd.gaodun.com/api/leftsite-tts/convert';
                const testData = {
                    text: 'æµ‹è¯•',
                    voice: 'zh-CN-XiaoxiaoNeural'
                };
                
                console.log('ğŸ§ª API URL:', apiUrl);
                console.log('ğŸ§ª è¯·æ±‚æ•°æ®:', testData);
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                console.log('ğŸ§ª å“åº”çŠ¶æ€:', response.status);
                console.log('ğŸ§ª å“åº”å¤´:', Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('ğŸ§ª APIé”™è¯¯:', errorText);
                    resultDiv.innerHTML = `âŒ APIè°ƒç”¨å¤±è´¥: ${response.status} - ${errorText}`;
                    return;
                }
                
                const blob = await response.blob();
                console.log('ğŸ§ª éŸ³é¢‘æ•°æ®:', {
                    size: blob.size,
                    type: blob.type
                });
                
                if (blob.size === 0) {
                    resultDiv.innerHTML = 'âŒ è¿”å›çš„éŸ³é¢‘æ•°æ®ä¸ºç©º';
                    return;
                }
                
                // åˆ›å»ºéŸ³é¢‘URLå¹¶å°è¯•æ’­æ”¾
                const audioUrl = URL.createObjectURL(blob);
                const audio = new Audio(audioUrl);
                
                audio.onloadstart = () => console.log('ğŸµ éŸ³é¢‘å¼€å§‹åŠ è½½');
                audio.oncanplay = () => console.log('ğŸµ éŸ³é¢‘å¯ä»¥æ’­æ”¾');
                audio.onplay = () => console.log('ğŸµ éŸ³é¢‘å¼€å§‹æ’­æ”¾');
                audio.onended = () => console.log('ğŸµ éŸ³é¢‘æ’­æ”¾ç»“æŸ');
                audio.onerror = (e) => {
                    console.error('ğŸµ éŸ³é¢‘æ’­æ”¾é”™è¯¯:', e);
                    console.error('ğŸµ éŸ³é¢‘çŠ¶æ€:', {
                        readyState: audio.readyState,
                        networkState: audio.networkState,
                        error: audio.error
                    });
                };
                
                try {
                    await audio.play();
                    resultDiv.innerHTML = 'âœ… TTS APIæµ‹è¯•æˆåŠŸï¼ŒéŸ³é¢‘æ­£åœ¨æ’­æ”¾';
                } catch (playError) {
                    console.error('ğŸµ æ’­æ”¾å¤±è´¥:', playError);
                    resultDiv.innerHTML = `âŒ éŸ³é¢‘æ’­æ”¾å¤±è´¥: ${playError.message}`;
                }
                
            } catch (error) {
                console.error('ğŸ§ª æµ‹è¯•é”™è¯¯:', error);
                resultDiv.innerHTML = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        }
    </script>
</body>
</html>